<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Work Hours Log</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background-color: #f9f9f9;
      text-align: center;
    }
    h1, h2 {
      margin-bottom: 20px;
    }
    /* Container for the editable table and delete buttons */
    #log-container {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      gap: 10px;
    }

    #delete-table {
      border-collapse: collapse;
    }
    #delete-table td {
    //border: 1px solid #ddd;
      padding: 10px;
    //margin: 0;
      text-align: right;
      vertical-align: middle;
      width: 40px; /* Fixed width for the delete column */
    }

    /* Table styling */
    #work-hours-table table {
      width: 80%;
      max-width: 600px;
      border-collapse: collapse;
    }
    #work-hours-table th, #work-hours-table td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: center;
    }
    th {
      background-color: #f1f1f1;
      font-weight: bold;
    }
    /* Controls for buttons below the table */
    #controls {
      margin-top: 20px;
    }
    #controls button {
      padding: 5px 10px;
      margin: 2px;
      cursor: pointer;
      border: none;
      background-color: #4CAF50;
      color: white;
      border-radius: 4px;
    }

    #summary-table {
      width: 50%;
      margin: 20px auto; /* Centers the table horizontally */
      border-collapse: collapse;
    }

    #summary-table th, #summary-table td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: center;
    }

    #summary-table th {
      background-color: #f1f1f1;
      font-weight: bold;
    }

  </style>
</head>
<body>
<h1>Work Hours Log</h1>

<div id="log-container">

  <!-- Left "invisible" table for delete buttons -->
  <table id="delete-table">
    <tbody>
    <tr>
      <td><button class="delete-btn">-</button></td>
    </tr>
    <tr>
      <td><button class="delete-btn">-</button></td>
    </tr>
    <tr>
      <td><button class="delete-btn">-</button></td>
    </tr>
    </tbody>
  </table>

  <!-- Data table -->
  <table id="work-hours-table">
    <thead>
    <tr>
      <th>Project</th>
      <th>Task</th>
      <th>Hours</th>
    </tr>
    </thead>
    <tbody>
    <tr>
      <td contenteditable="true">Project A</td>
      <td contenteditable="true">Bug Fix</td>
      <td contenteditable="true">3</td>
    </tr>
    <tr>
      <td contenteditable="true">Project B</td>
      <td contenteditable="true">Feature Development</td>
      <td contenteditable="true">5</td>
    </tr>
    </tbody>
  </table>
</div>

<!-- Controls for adding and saving entries -->
<div id="controls">
  <button id="add-entry">Add New Entry</button>
  <button id="save-changes">Save Changes</button>
</div>

<h2>Project Summary</h2>

<!-- Summary Table: For each unique Project, total hours -->
<table id="summary-table">
  <thead>
  <tr>
    <th>Project</th>
    <th>Total Hours</th>
  </tr>
  </thead>
  <tbody>
  <!-- Summary rows will be generated dynamically -->
  </tbody>
</table>

<script>
  // Update the delete column to match the number of rows
  function updateDeleteTable() {
    const tbody = document.querySelector('#work-hours-table tbody'); // Main table body
    const deleteTbody = document.querySelector('#delete-table tbody'); // Delete table body

    // Get all rows except the first (header row is in <thead>, so tbody rows are safe)
    //const rows = tbody.querySelectorAll('tr');
    const rows = Array.from(tbody.querySelectorAll('tr'));
    // Clear the delete table
    deleteTbody.innerHTML = '';

    for (let i = 0; i <= rows.length; i++) {
      const deleteRow = document.createElement('tr');
      const deleteCell = document.createElement('td');

      if (i === 0){
      deleteCell.innerHTML = '&nbsp;';
      }
      else{
        const btn = document.createElement('button'); // Create delete button
        btn.className = 'delete';
        btn.innerText = '-';
        btn.onclick = function (index) {
          removeRow(index);
        };
        deleteCell.appendChild(btn); // Add button to the cell
      }
      deleteRow.appendChild(deleteCell);
      deleteTbody.appendChild(deleteRow);

    }


    // Create a delete button row for each work hours row
    /*rows.forEach((row) => {

      const deleteRow = document.createElement('tr'); // Create a new row
      const deleteCell = document.createElement('td'); // Create a cell for the button

      if (row.rowIndex === 1) {
        deleteCell.innerHTML = '&nbsp;';
      }
      else {
        const btn = document.createElement('button'); // Create delete button
        btn.className = 'delete';
        btn.innerText = '-';
        btn.onclick = function () {
          removeRow(index);
        };
        deleteCell.appendChild(btn); // Add button to the cell
      }
      deleteRow.appendChild(deleteCell); // Add cell to the row
      deleteTbody.appendChild(deleteRow); // Add row to the delete table
    });*/
  }

  // Remove a row and update the delete column
  function removeRow(rowIndex) {
    const tbody = document.querySelector('#work-hours-table tbody');
    const rows = tbody.querySelectorAll('tr');
    if (rowIndex < rows.length) {
      rows[rowIndex].remove();
      updateDeleteTable();
      updateSummaryTable();
    }
  }

  // Gather table data and update the summary table
  function updateSummaryTable() {
    const tbody = document.querySelector('#work-hours-table tbody');
    const rows = tbody.querySelectorAll('tr');
    const summary = {}; // Object to accumulate hours per project

    rows.forEach(row => {
      const cells = row.querySelectorAll('td');
      // Extract project name and hours, trimming any extra spaces.
      const project = cells[0].innerText.trim();
      const hoursText = cells[2].innerText.trim();
      // Parse hours to a number; if invalid, treat as 0.
      const hours = parseFloat(hoursText) || 0;

      if (project in summary) {
        summary[project] += hours;
      } else {
        summary[project] = hours;
      }
    });

    // Now update the summary table's tbody
    const summaryTbody = document.querySelector('#summary-table tbody');
    summaryTbody.innerHTML = ''; // Clear previous summary

    // For each project, add a new row with the project name and total hours.
    for (const project in summary) {
      const row = document.createElement('tr');
      row.innerHTML = `
          <td>${project}</td>
          <td>${summary[project]}</td>
        `;
      summaryTbody.appendChild(row);
    }
  }

  //main
  // listen to click event on button add entry
  // Add a new editable row to the table
  document.getElementById('add-entry').addEventListener('click', () => {
    const tbody = document.querySelector('#work-hours-table tbody');
    const newRow = document.createElement('tr');
    newRow.innerHTML = `
        <td contenteditable="true">New Project</td>
        <td contenteditable="true">New Task</td>
        <td contenteditable="true">0</td>
      `;
    tbody.appendChild(newRow);
    updateDeleteTable();
    updateSummaryTable();
  });

  // When "Save Changes" is clicked, log table data and update summary.
  document.getElementById('save-changes').addEventListener('click', () => {
    const tbody = document.querySelector('#work-hours-table tbody');
    const rows = tbody.querySelectorAll('tr');
    const entries = [];
    //Trim entries of all rows and
    rows.forEach(row => {
      const cells = row.querySelectorAll('td');
      const entry = {
        project: cells[0].innerText.trim(),
        task: cells[1].innerText.trim(),
        hours: cells[2].innerText.trim()
      };
      entries.push(entry);
    });
    console.log('Updated Entries:', entries);
    updateSummaryTable();
    // Optionally, send 'entries' to your FastAPI backend via fetch() here.
  });

  // Initialize the delete column and summary table on page load.
  updateDeleteTable();
  updateSummaryTable();
</script>
</body>
</html>
